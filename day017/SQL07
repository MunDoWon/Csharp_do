#DEPT 테이블의 내용을 복사한 테이블 DEPT_COPY
#테이블 만들어주세요
CREATE TABLE DEPT_COPY AS SELECT * FROM DEPT;
SELECT * FROM DEPT_COPY2;
#DEPT 테이블의 구조만 복사한 DEPT_COPY2만들기
CREATE TABLE DEPT_COPY2 AS SELECT * FROM DEPT WHERE 1<>1 ;
#DEPT_COPT2 테이블에 1,'홍길동','안동'
INSERT INTO DEPT_COPY2(DEPTNO,DNAME,LOC)
VALUES(3,'강감찬','평양');
#UPDATE 강감찬의 지역을 '서울'로 변경
UPDATE DEPT_COPY2 SET LOC ='서울' WHERE LOC = '평양';
#1번 홍길동데이터 삭제
DELETE FROM DEPT_COPY2 WHERE DEPTNO=1;
#테이블 삭제 EMP_TEMP
DROP TABLE EMP_TEMP;
#EMP테이블 전체복사
CREATE TABLE EMP_TEMP AS SELECT * FROM EMP WHERE 1<>1;
#(9999,'홍길동','사장','','2001/01/01',5000,1000,10)삽입하소
INSERT INTO EMP_TEMP
VALUES (9998,'홍길동','사장','','2001/01/01',5000,1000,10);
DELETE FROM EMP_TEMP WHERE EMPNO = 9999;
SELECT * FROM EMP_TEMP;

CREATE TABLE CHAP10HW_EMP AS SELECT * FROM EMP;
CREATE TABLE CHAP10HW_DEPT AS SELECT * FROM DEPT;
CREATE TABLE CHAP10HW_SALGRADE AS SELECT * FROM SALGRADE;

#287-1 50,60,70,80부서 등록
INSERT INTO CHAP10HW_DEPT
VALUES (80,'DML','BUNDANG');
SELECT * FROM CHAP10HW_DEPT;

#287-2 복사EMP에 등록
INSERT INTO  CHAP10HW_EMP
VALUES (7208,'TEST_USER8','STUDENT',7201,'2018-03-09',1200,'',80);
SELECT * FROM CHAP10HW_EMP;
COMMIT;
#287-3 50부서 평균급여보다 많은 사원을 70으로 옮겨라
UPDATE CHAP10HW_EMP SET DEPTNO = 70
WHERE SAL > (SELECT AVG(SAL) FROM CHAP10HW_EMP WHERE DEPTNO=50);
ROLLBACK;
#287-4 60부서 입사일 가장빠른사원보다 늦은사원 급여 10%인상 후 80부서로 이전
UPDATE CHAP10HW_EMP SET DEPTNO = 80, SAL=SAL*1.1
WHERE HIREDATE >
(SELECT MIN(HIREDATE) FROM CHAP10HW_EMP WHERE DEPTNO=60);
#287-5 급여 5등급인사원삭제
DELETE FROM CHAP10HW_EMP WHERE SAL IN
(SELECT E.SAL FROM CHAP10HW_EMP E,CHAP10HW_SALGRADE S
WHERE SAL BETWEEN S.LOSAL AND S.HISAL AND GRADE = 5);
SELECT * FROM CHAP10HW_EMP;


/*컬럼이름 생성규칙
1. 컬럼이름은 문자로 시작해야한다.
2. 컬럼이름은 30BYTES이하여야한다.
3. 한 테이블의 컬림 이름은 중복될수 없다.
4. 컬럼이름은 영문자(한글),숫자(0-9),특문 사용가능
5. SQL 키워드는 컬럼이름 등으로 사용할 수 없다.
*/
#테이블 만들기
CREATE TABLE EMP_DDL(
    EMPNO    NUMBER(4),
    ENAME    VARCHAR2(10),
    JOB      VARCHAR2(9),
    MGR      NUMBER(4),
    HIREDATE DATE,
    SAL      NUMBER(7,2),
    COMM     NUMBER(7,2),
    DEPTNI   NUMBER(2)
);
#테이블 구조 변경 ALTER
CREATE TABLE EMP_ALTER
    AS SELECT * FROM EMP;
SELECT * FROM EMP_ALTER;
#컬럼추가
ALTER TABLE EMP_ALTER
ADD HP VARCHAR2(20);
#TEL 컬럼추가 VARCHAR2(20)
ALTER TABLE EMP_ALTER
ADD TEL VARCHAR2(20);
#TEL 컬럼삭제
ALTER TABLE EMP_ALTER
DROP COLUMN TEL;

#변경 HP--> TEL
ALTER TABLE EMP_ALTER
RENAME COLUMN HP TO TEL;
COMMIT;

#컬럼의 이름변경하는게 아닌 타입을 바꾸고 싶어
#EMPNO : NUMBER(4)-->NUMBER(5)
DESC EMP_ALTER;

ALTER TABLE EMP_ALTER 
    MODIFY EMPNO NUMBER(5);
#ENAME : VARCHAR2(10) --> VARCHAR2(13)
ALTER TABLE EMP_ALTER
    MODIFY ENAME VARCHAR2(13);
#TEL-->PHONENUMBER 이름변경
ALTER TABLE EMP_ALTER
 RENAME COLUMN TEL TO PHONENUMBER;
#테이블의 이름을 변결해 보세요
#EMP_ALTER --> EMP_RENAME
RENAME EMP_ALTER TO EMP_RENAME;
SELECT * FROM EMP_RENAME;

#데이블의 데이터를 강제로 삭제
TRUNCATE TABLE EMP_RENAME;
SELECT * FROM EMP_RENAME;
COMMIT;
DROP TABLE EMP_RENAME;

#324-1
CREATE TABLE EMP_HW(
    EMPNO       NUMBER(4),
    ENAME       VARCHAR2(10),
    JOB         VARCHAR2(9),
    MGR         NUMBER(4),
    HIREDATE    DATE,
    SAL         NUMBER(7,2),
    COMM        NUMBER(7,2),
    DEPTNO      NUMBER(2)
);

#324-2 EMP_HW에 BIGO열 추가,가변형 문자열 자료형 길이20
ALTER TABLE EMP_HW 
    ADD BIGO VARCHAR2(20);
    
#324-3 BIGO열크기 30으로 변경
ALTER TABLE EMP_HW
    MODIFY BIGO VARCHAR2(30);
DESC EMP_HW;

#324-4 BIGO이름 REMARK로 변경
ALTER TABLE EMP_HW
    RENAME COLUMN BIGO TO REMARK;

#324-5 EMP_HW 에 EMP 데이터를 모두 저장하라 REMARK는 NULL삽입
INSERT INTO EMP_HW(EMPNO,ENAME,JOB,MGR,HIREDATE,SAL,COMM,DEPTNO,REMARK)
SELECT EMPNO,ENAME,JOB,MGR,HIREDATE,SAL,COMM,DEPTNO,NULL FROM EMP;
COMMIT;
#324-6 EMP_HW 삭제
DROP TABLE EMP_HW;
ROLLBACK;
    SELECT * FROM EMP_HW;
    

#14장 제약

#테이블 생성 시 NOT NULL 값 설정
CREATE TABLE TABLE_NOTNULL (
    LOGIN_ID        VARCHAR2(20) NOT NULL,
    LOGIN_PWD       VARCHAR2(20) NOT NULL,
    TEL             VARCHAR2(20) 
    );
SELECT * FROM TABLE_NOTNULL;
INSERT INTO TABLE_NOTNULL
VALUES ('TEST_ID_01','1234','010-1234-5678');

#나의 계정의 제약을 확인해 봅시다.
#14-5
SELECT OWNER, CONSTRAINT_NAME,CONSTRAINT_TYPE,TABLE_NAME
FROM USER_CONSTRAINTS;

#테이블을 만들때 제약조건의 이름을 지정해서 만들기
CREATE TABLE TABLE_NOTNULL2 (
    LOGIN_ID        VARCHAR2(20) CONSTRAINT MY_LOGID NOT NULL,
    LOGIN_PWD       VARCHAR2(20) CONSTRAINT MY_LOGPWD NOT NULL,
    TEL             VARCHAR2(20) 
    );
SELECT * FROM TABLE_NOTNULL2;
SELECT OWNER, CONSTRAINT_NAME,CONSTRAINT_TYPE,TABLE_NAME
FROM USER_CONSTRAINTS;
#제약조건이 없는 컬럼을 제약조건지정하기(데이터가 없어야함)
ALTER TABLE TABLE_NOTNULL
MODIFY TEL NOT NULL;
DESC TABLE_NOTNULL;
DELETE FROM TABLE_NOTNULL;

# FOREIGN KEY 지정하기
#14-39 DEPT_FT 테이블 생성
CREATE TABLE DEPT_FK(
    DEPTNO NUMBER(2) CONSTRAINT DEPRFK_DEPTNO_PK PRIMARY KEY,
    DNAME VARCHAR2(14),
    LOC   VARCHAR2(13)
    );
    DESC DEPT_FK;
#14-40
CREATE TABLE EMP_FK(
    EMPNO   NUMBER(4) CONSTRAINT EMPFK_EMPNO_PK PRIMARY KEY,
    
DEPTNO      NUMBER(2) REFERENCES DEPT_FK(DEPTNO)
);
